<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>


</head>
<body>
<script type = "text/javascript">

    function getQueryVariable(variable) {
        let query = window.location.search.substring(1);
        let vars = query.split("&");
        for (let i=0;i<vars.length;i++) {
            let pair = vars[i].split("=");

            if(pair[0] == variable){return pair[1];}
        }
        return(false);
    }

    let returnedCode = null;
    if ("WebSocket" in window) {

        //var test = window.location.querystring["param"];
        alert(getQueryVariable("code"))
        returnedCode = getQueryVariable("code");

        // Let us open a web socket
        var ws = new WebSocket("ws://localhost:9280");

        ws.onopen = function() {
            // Web Socket is connected, send data using send()

            // change this to true for testing
            if (returnedCode){
                // testing getRewardListAPI
                let json = JSON.stringify({service: "reward", functionName: "getRewardList", data: {platformId: "1"}});
                ws.send(json);
                alert("Message is sent...");
            }

        };

        ws.onmessage = function (evt) {
            let received_msg = evt.data;
            console.log(received_msg)
            alert("Message is received...");
            if (received_msg){
                // redirect to the desired link
                window.location.href = "https://www.google.com/"
            }
        };

        ws.onclose = function() {
            // websocket is closed.
            alert("Connection is closed...");
        };
    } else {

        // The browser doesn't support WebSocket
        alert("WebSocket NOT supported by your Browser!");
    }

</script>
</body>
</html>